python_preamble:
- import: base64
- import: re
- import: google.appengine.ext.bulkload.transform
- import: google.appengine.ext.bulkload.bulkloader_wizard
- import: google.appengine.ext.db
- import: google.appengine.api.datastore
- import: google.appengine.api.users
- import: bulkload_helper
- import: ndb

transformers:

- kind: Layer
  connector: csv
  connector_options:
    encoding: utf_8
  
  property_map:
    - property: __key__
      import_template: "%(layer_source)s-%(layer_collection)s-%(layer_filename)s"

    - property: source
      external_name: layer_source
      import_transform: transform.none_if_empty(str)

    - property: collection
      external_name: layer_collection
      import_transform: transform.none_if_empty(str)

    - property: filename
      external_name: layer_filename
      import_transform: transform.none_if_empty(str)

    - property: json
      external_name: json
      import_transform: bulkload_helper.create_layer_json()

- kind: LayerIndex
  connector: csv
  connector_options:
    encoding: utf_8

  property_map:
    - property: __key__
      external_name: layer_source
      import_transform: bulkload_helper.create_layer_index_key()
    
    - property: polygons
      external_name: layer_dbf
      import_transform: bulkload_helper.get_polygons()

    - property: dbfjson
      external_name: layer_dbf
      import_transform: transform.none_if_empty(db.Text)

    - property: corpus
      external_name: layer_source
      import_transform: bulkload_helper.get_corpus_list()

    - property: accessrights
      external_name: accessrights
      import_transform: transform.none_if_empty(str)

    - property: bibliographiccitation
      external_name: bibliographiccitation
      import_transform: transform.none_if_empty(str)

    - property: breedingdomain
      external_name: breedingdomain
      import_transform: transform.none_if_empty(str)

    - property: contact
      external_name: contact
      import_transform: transform.none_if_empty(str)

    - property: coverage
      external_name: coverage
      import_transform: transform.none_if_empty(str)

    - property: creator
      external_name: creator
      import_transform: transform.none_if_empty(str)

    - property: date
      external_name: date
      import_transform: transform.none_if_empty(str)

    - property: description
      external_name: description
      import_transform: transform.none_if_empty(str)

    - property: email
      external_name: email
      import_transform: transform.none_if_empty(str)

    - property: eventdate
      external_name: eventdate
      import_transform: transform.none_if_empty(str)

    - property: layertype
      external_name: layertype
      import_transform: transform.none_if_empty(str)

    - property: nonbreedingdomain
      external_name: nonbreedingdomain
      import_transform: transform.none_if_empty(str)

    - property: presencedefault
      external_name: presencedefault
      import_transform: transform.none_if_empty(str)

    - property: publisher
      external_name: publisher
      import_transform: transform.none_if_empty(str)

    - property: samplingprotocol
      external_name: samplingprotocol
      import_transform: transform.none_if_empty(str)

    - property: scientificname
      external_name: scientificname
      import_transform: transform.none_if_empty(str)

    - property: source
      external_name: source
      import_transform: transform.none_if_empty(str)

    - property: subject
      external_name: subject
      import_transform: transform.none_if_empty(str)

    - property: taxonomiccoverage
      external_name: taxonomiccoverage
      import_transform: transform.none_if_empty(str)

    - property: title
      external_name: title
      import_transform: transform.none_if_empty(str)

    - property: verbatimsrs
      external_name: verbatimsrs
      import_transform: transform.none_if_empty(str)

